---
layout:     post
title:      0701实习记录
date:       2021-07-01
author:     DAC
header-img: img/post-bg-desk.jpg
catalog: true
tags:
    - 实习日报
---

### 本周任务
* 完成两种数据库的编译与调试，目前已完成了postgresql，openGauss尚待新设备到来。比较完整的编译与环境配置要点已记在前两天实习记录中。

### 今日目标
* 如果新设备到场则争取完成openGauss的编译，未到场则先阅读文档与源码。

### xtuner源码阅读
这里我比较关注的是，如何与数据库进行连接、如何进行特征表示建立数据集、如何进行性能评价等。
* main函数入口，调用procedure_main函数，传入mode, db_info, config三个参数
* mode为args输入，分为train, tune, recommend三种；db_info同为args输入，包含数据库相关信息与IP、端口；config由文件xtuner.conf提供；此外还有一些正确性检查。
* 若干参数与变量解释：
  * knobs
* xtuner调用模块如下：
  * benchmark模块：benchmark运行环境，进行性能检查，得到一个instance
  * db_agent模块：封装好了一个DB_Agent类，通过db_info中的参数构造。
  * recommend模块中的recommend_knobs函数。（理解knobs的作用和意义是关键）
  * recorder模块：
  * db_env模块：

* procedure_main函数为xtuner部分主函数。该函数首先会进行如下预处理过程：
  * 根据db_info生成db_agent
  * 在db_agent中设置scenario，即workload工作场景
  * 设置config['tune_strategy']，有rl和gop两种类型。
  * recommend_knobs，或根据config给出设置（默认为前者）

* 训练过程
  * train: rl_model函数，传入mode, Env, config，其中Env为一个DB_Env类实例

* 算法及相关资料
  * policy gradient: https://zhuanlan.zhihu.com/p/21725498
  * 强化学习：https://zhuanlan.zhihu.com/p/150451604
  * ddpg算法：https://zhuanlan.zhihu.com/p/111257402